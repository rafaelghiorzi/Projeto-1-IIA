{% extends 'base.html' %}

{% block content %}
<div>
    <h1>{{ produtor.nome }}</h1>
    <p>Localização: {{ produtor.lat }}, {{ produtor.lon }}</p>
    
    <div class="map-container">
        <div id="map"></div>
    </div>
    
    <h3>Produtos Disponíveis:</h3>
    <ul>
        {% for produto in produtor.produtos.all %}
            <li>{{ produto.nome }} ({{ produto.sazonalidade }}) - {{ produto.descricao }}</li>
        {% endfor %}
    </ul>
    
    <h3>Avaliações (Média: {{ avg_rating }}⭐)</h3>
    {% if user.is_authenticated %}
        <form method="post">
            {% csrf_token %}
            <select name="rating">
                <option value="5">5 ⭐</option>
                <option value="4">4 ⭐</option>
                <option value="3">3 ⭐</option>
                <option value="2">2 ⭐</option>
                <option value="1">1 ⭐</option>
            </select>
            <textarea name="comentario" required></textarea>
            <button type="submit">Enviar Avaliação</button>
        </form>
    {% endif %}
    
    <div class="reviews">
        {% for review in reviews %}
            <div class="review">
                <strong>{{ review.usuario.username }}</strong>
                <span class="rating">{{ '⭐' * review.rating }}</span>
                <p>{{ review.comentario }}</p>
                <small>{{ review.data }}</small>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    var lat = {{ produtor.lat|default:0 }};
    var map = L.map('map').setView([{{ produtor.lat }}, {{ produtor.lon }}], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    L.marker([{{ produtor.lat }}, {{ produtor.lon }}]).addTo(map);
</script>
{% endblock %}